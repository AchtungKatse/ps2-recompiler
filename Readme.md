# PS2 Recompiler
This project is an experimental tool that can automatically convert PS2 R5900 instructions to C, allowing it to be recompiled and run natively on any architecture. This project takes inspiration from [N64Recomp](https://github.com/N64Recomp/N64Recomp), although it has a few differences. Most notably, dynamically loaded overlays are not currently supported and need to be reloctated at compile time. For development purposes, the tool is currently being tested agains Shadow of the Colossus and is expected to grow support for various PS2 games over time.

# How It Works
PS2RC uses a splits file, which defines the start and end for all functinos in an executable, then convert the assembly for each function into a series of C macros that can be compiled into any architecture and run natively for different playforms, namely PC. Additionally, the PS2 kernel has been reimplemented to communicate between the runtime and host device. The split file can be initially generated by ps2rc and later updated to change function names, parameters, and return types. This allows user code to automatically interface with generated code to allow for easy modification of existing games.

An interesting side effect of using an elf file is that a large number of games released with debug symbols. This can be taken advantage of since PS2 SDK functions can be reverse engineered and reimplemented, allowing games to be recompiled with minimal user oversight.

# Status
- The current state of the application is able to recompile and run the main binary of Shadow of the Colossus, although crashes after loading the second of three overlay files. This issue is currently being looked into and seems to be related to host memory and virtual memory addresses. 
- The application is currently capable of re-routing libc calls such as printf to the host system.
- All relocations are capable of being applied at compile time.

# TODO
Currently, 
- [x] Code Emitter
- [x] Automatic Split Generation
- [ ] Bug Fixes
- [ ] CLI
- [ ] Graphics Reimplementation
- [ ] Input Reimplementation
- [ ] Sound Reimplementation

# Building
1. Clone the repository
```
    git clone https://github.com/AchtungKatse/ps2-recompiler.git --recurse-submodules
```
2. Build the recompiler
```
    mkdir build && cd build && cmake ..
    make -j [thread count] recompiler
```
3. Run the recompiler (Requires a config file and splits)
```
    ./recompiler [path to config.yaml] [output path]
```
4. Rerun cmake
This allows the program to identify generated code and link to libraries required for the recompilation.
```
    cmake ..
```
5. Build and run the recompiled game
```
    make -j [thread count]
    ./recompiled
```

